# AHC029

## ToDo

- ルールベース(Done)
  - 使用する方針カード選択
    - 増資(t=4)
    - 労働(t=0,1): 以下の大きい方を選択
      - t=0: w
      - t=1: w*M
    - 0番目を使用
  - プロジェクト選択: 残務量に対する価値が大きい方を選択
    - t=0
      - v/hが一番大きいプロジェクトを選択
      - ただしv/hが一定以下の場合はt=2, 3の方針カードを利用
    - t=2
      - v/hが一番小さいプロジェクトを選択
  - 新しい方針カード選択
    - 増資(t=4)
    - 労働(t=0,1)
      - 最大のw/p and w > 2*p
    - キャンセルはpが小さい物を選択
- 増資した時に、保持している方針カードを変更する。プロジェクトは自分で更新して増資を反映させる
-増資後の0の労働より大きいwのみを選択(Done)
- powershellでまとめて実行(Done)
- ルールベースのパラメータをoptunaで最適化
- 強化学習(DQNに挑戦)
  - 学習の方針
    - Agent(報酬が最大となる行動を選択)で実行した結果を貯める(行動と報酬のペアができる)
    - 学習する(報酬を一致するように学習する)
  - ToDo
    - ネットワークの構築(Done)
      - sklearnのMLPRegressorを使用(119, 32, 32, 20)
    - Agentを使っての実行(Done)
    - 学習データの蓄積(Done)
      - input: K, N, M, t, money, L, K(有無,t*5,w,p)*5, N(有無,t*5,w)*7, M(有無,h,v)*8
      - output: K*5, N*7, 8*Mのr(最終実行結果のmoneyを元に後から算出, 選択した結果の部分にrを入れる。他は0)
    - 学習の実行(Done)
    - 学習済みパラメータの読み込み(Done)
    - データを蓄積 -> 学習 を繰り返す

## After

- ルールベース
  - 時間で増資を選択しない(残り時間×増資後の無料カードの労働力<増資カードのコスト)(Done)
  - プロジェクトの残務量を超えないコストのカードを買う(Done)
  - 1以下ならキャンセルカードを選択して、効率を悪いプロジェクトを削除(Done)
- 評価関数
  - まずは簡単な評価関数を考える(Done)
  - モンテカルロの実装
  - 状態の価値(r)(eval_state)
    - 方針カードとプロジェクトの状態で決まる。購入するカードを決める指針になる
    - 所持金、現在の方針カードとプロジェクトで将来いくら所持金を増やせるかで決まる
    - 簡単な評価関数: money + w
  - 行動の価値(c, m)(eval_action)
    - どの方針カードをどのプロジェクトに使うかで決まる
    - いくら所持金が増えるか、将来いくら所持金を増やせるかで決まる
    - 簡単な評価関数: min(w, h)
    - いくら所持金が増えるか
      - 確定的に決まる。基本的にはプロジェクトの残務(初期値？)に対するプロジェクトの価値×かける労働力
      - 労働力の価値: プロジェクトの価値/初期残務×min(労働力, 残務)
    - 将来いくら所持金を増やせるか
      - 所持金が増えたことにより、将来増やせる可能性を高める
      - キャンセルで効率の悪いプロジェクトを削除することで、将来の所持金を増やせる可能性を高める。ただし1ターン消費するマイナス点もある
      - 増資により将来所持金を増やせる可能性を2倍にする
      - 現在のターンまでに消費した所持金と獲得した所持金、総労働力により1ターンの価値や将来の価値を算出する
      - 労働による獲得予定の所持金の将来の価値: 獲得した所持金/消費した所持金/現在のターン数×残りのターン数×獲得予定の所持金
      - キャンセルの将来の価値: プロジェクトの-(価値-残務)-(初期残務-残務)(価値と残務が逆転している場合にキャンセルの価値が出る。マイナスを0に戻す分だけプラスになるという考え方。ただしすでに労働した分はマイナスの価値になる)
      - 増資の将来の価値: 

## history

- v0: サンプルコード(スコア: 54,598, 評価: 52,175)
- v1: 増資優先で、効率の良い労働を実施(スコア: 24,618,189, 評価: 7,686,566)
- v2: w/pが最大の評価をされていなかったバグを修正(順位: 353, スコア: 36,412,213, 評価: 15,467,855)
- after(ルールベース)
- v3: 時間で増資を選択しない(残り時間×増資後の無料カードの労働力<増資カードのコスト)(順位: 294, スコア: 149,954,901, 評価: 26,476,031)
- v4: キャンセルカード採用(ALLは不使用)(順位: 271, スコア: 122,303,674, 評価: 33,404,831)
- v5: プロジェクトの残務量を超えないコストのカードを買う(順位: 268, スコア: 285,486,294, 評価: 30,996,205)
- v6: 効率が悪いプロジェクトが多い場合のみキャンセルカードを使用等キャンセルカードの使用を制限(順位: 294, スコア: 110,952,485, 評価: 30,009,744)
- after(評価関数)
- v7: 簡単な評価関数で実行(順位: 563, スコア: 54,784, 評価: 51,918)
